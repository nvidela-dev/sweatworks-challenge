<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Solution Diagram — Fitness Member Management</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f8f9fa; color: #1a1a2e; }

    .page {
      width: 1120px;
      margin: 24px auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      padding: 40px 48px;
    }

    h1 { font-size: 22px; font-weight: 700; margin-bottom: 4px; color: #1a1a2e; }
    .subtitle { font-size: 13px; color: #6b7280; margin-bottom: 32px; }

    .section-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #6b7280;
      margin-bottom: 16px;
      padding-bottom: 6px;
      border-bottom: 2px solid #e5e7eb;
    }

    .diagram-container {
      position: relative;
      width: 100%;
      height: 520px;
      margin-bottom: 32px;
    }

    svg { width: 100%; height: 100%; }

    /* Box styles */
    .box {
      rx: 8;
      ry: 8;
      stroke-width: 2;
    }

    .box-frontend { fill: #eff6ff; stroke: #3b82f6; }
    .box-backend { fill: #f0fdf4; stroke: #22c55e; }
    .box-database { fill: #fefce8; stroke: #eab308; }
    .box-aws { fill: #faf5ff; stroke: #a855f7; }
    .box-docker { fill: #f0f9ff; stroke: #0ea5e9; }

    .box-label {
      font-size: 13px;
      font-weight: 700;
      fill: #374151;
    }

    .box-sublabel {
      font-size: 10px;
      fill: #6b7280;
    }

    .tech-tag {
      font-size: 9px;
      font-weight: 600;
      fill: white;
      rx: 3;
      ry: 3;
    }

    .tag-bg-blue { fill: #3b82f6; }
    .tag-bg-green { fill: #22c55e; }
    .tag-bg-yellow { fill: #ca8a04; }
    .tag-bg-purple { fill: #a855f7; }
    .tag-bg-cyan { fill: #0ea5e9; }

    .arrow {
      stroke-width: 2;
      fill: none;
      marker-end: url(#arrowhead);
    }

    .arrow-data { stroke: #3b82f6; }
    .arrow-deploy { stroke: #a855f7; stroke-dasharray: 6,4; }

    .arrow-label {
      font-size: 9px;
      fill: #6b7280;
      font-style: italic;
    }

    .section-divider {
      stroke: #e5e7eb;
      stroke-width: 1;
      stroke-dasharray: 4,4;
    }

    .region-label {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .region-local { fill: #0ea5e9; }
    .region-aws { fill: #a855f7; }

    @media print {
      body { background: white; }
      .page { box-shadow: none; margin: 0; padding: 24px; width: 100%; }
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>Solution Diagram — Fitness Member Management Mini-MVP</h1>
    <p class="subtitle">Local development architecture (Docker Compose) and AWS target deployment</p>

    <div class="diagram-container">
      <svg viewBox="0 0 1024 500" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6" />
          </marker>
          <marker id="arrowhead-purple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#a855f7" />
          </marker>
        </defs>

        <!-- Region backgrounds -->
        <rect x="8" y="28" width="530" height="460" rx="12" fill="#f8fafc" stroke="#cbd5e1" stroke-width="1" stroke-dasharray="6,3" />
        <rect x="554" y="28" width="462" height="460" rx="12" fill="#faf5ff" stroke="#d8b4fe" stroke-width="1" stroke-dasharray="6,3" />

        <!-- Region labels -->
        <text x="24" y="20" class="region-label region-local">LOCAL DEVELOPMENT (Docker Compose)</text>
        <text x="570" y="20" class="region-label region-aws">AWS TARGET DEPLOYMENT</text>

        <!-- ===== LOCAL SIDE ===== -->

        <!-- Browser -->
        <rect x="28" y="56" width="160" height="72" class="box box-frontend" />
        <text x="108" y="82" text-anchor="middle" class="box-label">Browser</text>
        <text x="108" y="98" text-anchor="middle" class="box-sublabel">User Interface</text>
        <rect x="58" y="108" width="100" height="16" rx="3" class="tag-bg-blue" />
        <text x="108" y="119" text-anchor="middle" class="tech-tag" fill="white">localhost:5173</text>

        <!-- Frontend Container -->
        <rect x="28" y="160" width="160" height="100" class="box box-frontend" />
        <text x="108" y="188" text-anchor="middle" class="box-label">Frontend</text>
        <text x="108" y="204" text-anchor="middle" class="box-sublabel">React 19 + TypeScript</text>
        <text x="108" y="218" text-anchor="middle" class="box-sublabel">Vite 7 + Tailwind CSS 4</text>
        <rect x="40" y="228" width="52" height="16" rx="3" class="tag-bg-cyan" />
        <text x="66" y="239" text-anchor="middle" class="tech-tag" fill="white">Dev: Vite</text>
        <rect x="98" y="228" width="80" height="16" rx="3" class="tag-bg-cyan" />
        <text x="138" y="239" text-anchor="middle" class="tech-tag" fill="white">Prod: nginx</text>

        <!-- Arrow: Browser -> Frontend -->
        <path d="M 108 128 L 108 158" class="arrow arrow-data" />

        <!-- API Container -->
        <rect x="28" y="300" width="160" height="100" class="box box-backend" />
        <text x="108" y="328" text-anchor="middle" class="box-label">Backend API</text>
        <text x="108" y="344" text-anchor="middle" class="box-sublabel">Express 4 + TypeScript</text>
        <text x="108" y="358" text-anchor="middle" class="box-sublabel">Drizzle ORM + Zod</text>
        <rect x="44" y="368" width="56" height="16" rx="3" class="tag-bg-green" />
        <text x="72" y="379" text-anchor="middle" class="tech-tag" fill="white">Port 3000</text>
        <rect x="106" y="368" width="70" height="16" rx="3" class="tag-bg-green" />
        <text x="141" y="379" text-anchor="middle" class="tech-tag" fill="white">Swagger UI</text>

        <!-- Arrow: Frontend -> API -->
        <path d="M 108 260 L 108 298" class="arrow arrow-data" />
        <text x="118" y="283" class="arrow-label">HTTP /api/*</text>

        <!-- Database -->
        <rect x="28" y="436" width="160" height="48" class="box box-database" />
        <text x="108" y="460" text-anchor="middle" class="box-label">PostgreSQL 16</text>
        <rect x="56" y="468" width="104" height="14" rx="3" class="tag-bg-yellow" />
        <text x="108" y="478" text-anchor="middle" class="tech-tag" fill="white">Port 5432 + Volume</text>

        <!-- Arrow: API -> DB -->
        <path d="M 108 400 L 108 434" class="arrow arrow-data" />
        <text x="118" y="422" class="arrow-label">SQL (Drizzle)</text>

        <!-- Data flow detail box -->
        <rect x="228" y="56" width="296" height="174" class="box" fill="#ffffff" stroke="#e5e7eb" />
        <text x="244" y="78" class="box-label" font-size="12">Data Flow</text>

        <text x="244" y="100" class="box-sublabel" font-size="10">1. Browser renders React SPA (lazy-loaded routes)</text>
        <text x="244" y="116" class="box-sublabel" font-size="10">2. Custom hooks call typed API client (fetch-based)</text>
        <text x="244" y="132" class="box-sublabel" font-size="10">3. Vite proxy (dev) or nginx (prod) → Express API</text>
        <text x="244" y="148" class="box-sublabel" font-size="10">4. Zod validates → Controller → Service → Repository</text>
        <text x="244" y="164" class="box-sublabel" font-size="10">5. Drizzle ORM queries PostgreSQL</text>
        <text x="244" y="180" class="box-sublabel" font-size="10">6. Consistent JSON envelope response:</text>
        <text x="256" y="196" class="box-sublabel" font-size="9" font-family="monospace">{ success, data, meta?, error? }</text>
        <text x="244" y="218" class="box-sublabel" font-size="10">7. AbortController cancels in-flight on unmount</text>

        <!-- Key constraints box -->
        <rect x="228" y="250" width="296" height="128" class="box" fill="#ffffff" stroke="#e5e7eb" />
        <text x="244" y="272" class="box-label" font-size="12">Key Constraints</text>

        <text x="244" y="294" class="box-sublabel" font-size="10">Unique email per member (DB UNIQUE)</text>
        <text x="244" y="312" class="box-sublabel" font-size="10">One active membership (partial unique index</text>
        <text x="256" y="326" class="box-sublabel" font-size="10">+ application SELECT...FOR UPDATE lock)</text>
        <text x="244" y="344" class="box-sublabel" font-size="10">Check-in requires active membership (service check</text>
        <text x="256" y="358" class="box-sublabel" font-size="10">+ DB trigger validates member/membership match)</text>
        <text x="244" y="374" class="box-sublabel" font-size="10">Soft-delete for members (is_deleted flag)</text>

        <!-- Docker label -->
        <rect x="228" y="400" width="296" height="84" class="box box-docker" />
        <text x="244" y="422" class="box-label" font-size="12">Docker Compose Services</text>
        <text x="244" y="442" class="box-sublabel" font-size="10">db: postgres:16-alpine (healthcheck + volume)</text>
        <text x="244" y="458" class="box-sublabel" font-size="10">api: Node 20 Alpine (tsx watch, hot reload)</text>
        <text x="244" y="474" class="box-sublabel" font-size="10">frontend: Node 20 Alpine (Vite HMR)</text>

        <!-- ===== AWS SIDE ===== -->

        <!-- CloudFront + S3 -->
        <rect x="580" y="56" width="200" height="76" class="box box-aws" />
        <text x="680" y="80" text-anchor="middle" class="box-label">CloudFront + S3</text>
        <text x="680" y="96" text-anchor="middle" class="box-sublabel">Static SPA hosting</text>
        <text x="680" y="112" text-anchor="middle" class="box-sublabel">CDN edge caching + HTTPS</text>
        <rect x="624" y="118" width="112" height="14" rx="3" class="tag-bg-purple" />
        <text x="680" y="128" text-anchor="middle" class="tech-tag" fill="white">React build output</text>

        <!-- ALB -->
        <rect x="580" y="164" width="200" height="52" class="box box-aws" />
        <text x="680" y="186" text-anchor="middle" class="box-label">Application Load Balancer</text>
        <text x="680" y="200" text-anchor="middle" class="box-sublabel">HTTPS termination, /api/* routing</text>

        <!-- Arrow: CloudFront -> ALB -->
        <path d="M 680 132 L 680 162" class="arrow" stroke="#a855f7" style="marker-end: url(#arrowhead-purple)" />
        <text x="690" y="151" class="arrow-label" fill="#a855f7">/api/* requests</text>

        <!-- ECS Fargate -->
        <rect x="580" y="248" width="200" height="88" class="box box-aws" />
        <text x="680" y="272" text-anchor="middle" class="box-label">ECS Fargate</text>
        <text x="680" y="288" text-anchor="middle" class="box-sublabel">Express API containers</text>
        <text x="680" y="304" text-anchor="middle" class="box-sublabel">Auto-scaling, no server management</text>
        <rect x="610" y="312" width="140" height="16" rx="3" class="tag-bg-purple" />
        <text x="680" y="323" text-anchor="middle" class="tech-tag" fill="white">Node 20 + TypeScript</text>

        <!-- Arrow: ALB -> ECS -->
        <path d="M 680 216 L 680 246" class="arrow" stroke="#a855f7" style="marker-end: url(#arrowhead-purple)" />

        <!-- RDS -->
        <rect x="580" y="368" width="200" height="76" class="box box-aws" />
        <text x="680" y="392" text-anchor="middle" class="box-label">RDS PostgreSQL</text>
        <text x="680" y="408" text-anchor="middle" class="box-sublabel">Managed database</text>
        <text x="680" y="424" text-anchor="middle" class="box-sublabel">Multi-AZ, automated backups</text>
        <rect x="618" y="432" width="124" height="14" rx="3" class="tag-bg-purple" />
        <text x="680" y="442" text-anchor="middle" class="tech-tag" fill="white">Private subnet, VPC</text>

        <!-- Arrow: ECS -> RDS -->
        <path d="M 680 336 L 680 366" class="arrow" stroke="#a855f7" style="marker-end: url(#arrowhead-purple)" />
        <text x="690" y="356" class="arrow-label" fill="#a855f7">Private VPC</text>

        <!-- AWS extras -->
        <rect x="810" y="164" width="190" height="172" class="box" fill="#faf5ff" stroke="#d8b4fe" />
        <text x="826" y="186" class="box-label" font-size="11">Supporting Services</text>
        <text x="826" y="208" class="box-sublabel" font-size="10">Route 53: DNS + domain</text>
        <text x="826" y="226" class="box-sublabel" font-size="10">ACM: TLS certificates</text>
        <text x="826" y="244" class="box-sublabel" font-size="10">ECR: Docker image registry</text>
        <text x="826" y="262" class="box-sublabel" font-size="10">CloudWatch: Logs + metrics</text>
        <text x="826" y="280" class="box-sublabel" font-size="10">Secrets Manager: DB creds</text>
        <text x="826" y="298" class="box-sublabel" font-size="10">VPC: Network isolation</text>
        <text x="826" y="318" class="box-sublabel" font-size="10">WAF: API rate limiting</text>

        <!-- Deploy arrows from local to AWS -->
        <path d="M 188 196 Q 420 110 578 90" class="arrow arrow-deploy" style="marker-end: url(#arrowhead-purple)" />
        <text x="360" y="115" class="arrow-label" fill="#a855f7">Deploy: S3 + CloudFront invalidation</text>

        <path d="M 188 345 Q 420 345 578 280" class="arrow arrow-deploy" style="marker-end: url(#arrowhead-purple)" />
        <text x="340" y="335" class="arrow-label" fill="#a855f7">Deploy: ECR push + ECS rolling update</text>

        <path d="M 188 460 Q 420 460 578 410" class="arrow arrow-deploy" style="marker-end: url(#arrowhead-purple)" />
        <text x="350" y="460" class="arrow-label" fill="#a855f7">Migrate: Drizzle Kit → RDS</text>

      </svg>
    </div>

    <!-- Legend -->
    <div style="display: flex; gap: 24px; flex-wrap: wrap; font-size: 11px; color: #6b7280; border-top: 1px solid #e5e7eb; padding-top: 12px;">
      <div style="display: flex; align-items: center; gap: 6px;">
        <svg width="24" height="12"><line x1="0" y1="6" x2="24" y2="6" stroke="#3b82f6" stroke-width="2"/></svg>
        <span>Data flow (runtime)</span>
      </div>
      <div style="display: flex; align-items: center; gap: 6px;">
        <svg width="24" height="12"><line x1="0" y1="6" x2="24" y2="6" stroke="#a855f7" stroke-width="2" stroke-dasharray="4,3"/></svg>
        <span>Deployment path</span>
      </div>
      <div style="display: flex; align-items: center; gap: 6px;">
        <svg width="16" height="12"><rect width="16" height="12" rx="2" fill="#eff6ff" stroke="#3b82f6" stroke-width="1.5"/></svg>
        <span>Frontend</span>
      </div>
      <div style="display: flex; align-items: center; gap: 6px;">
        <svg width="16" height="12"><rect width="16" height="12" rx="2" fill="#f0fdf4" stroke="#22c55e" stroke-width="1.5"/></svg>
        <span>Backend</span>
      </div>
      <div style="display: flex; align-items: center; gap: 6px;">
        <svg width="16" height="12"><rect width="16" height="12" rx="2" fill="#fefce8" stroke="#eab308" stroke-width="1.5"/></svg>
        <span>Database</span>
      </div>
      <div style="display: flex; align-items: center; gap: 6px;">
        <svg width="16" height="12"><rect width="16" height="12" rx="2" fill="#faf5ff" stroke="#a855f7" stroke-width="1.5"/></svg>
        <span>AWS Services</span>
      </div>
    </div>
  </div>
</body>
</html>
